!function e(t,s,r){function n(o,c){if(!s[o]){if(!t[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=s[o]={exports:{}};t[o][0].call(d.exports,function(e){var s=t[o][1][e];return n(s?s:e)},d,d.exports,e,t,s,r)}return s[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,s){"use strict";window.App={config:e("./services/config"),models:{cache:e("./models/cache"),config:e("./models/config"),datastore:e("./models/datastore"),router:e("./models/router"),search:e("./models/search"),utility:e("./models/utility")},services:{items:e("./services/items"),mobs:e("./services/mobs"),search:e("./services/search"),utility:e("./services/utility"),vendors:e("./services/vendors")},tags:{},itemGrid:null,router:e("./router.js")}},{"./models/cache":2,"./models/config":3,"./models/datastore":4,"./models/router":5,"./models/search":6,"./models/utility":7,"./router.js":8,"./services/config":9,"./services/items":10,"./services/mobs":11,"./services/search":12,"./services/utility":13,"./services/vendors":14}],2:[function(e,t,s){"use strict";t.exports=Backbone.Model.extend({initialize:function(e){this.bucket=e;var t=localStorage.getItem("cache_"+e),s=localStorage.getItem("cache_added_"+e);try{this.cache=JSON.parse(t)}catch(r){console.error("Error parsing cache bucket: ",r)}try{this.cacheAdded=JSON.parse(s)}catch(r){console.error("Error parsing cache added array: ",r)}this.cache||(this.cache={}),this.cacheAdded||(this.cacheAdded=[])},getAll:function(){return this.cache},getValue:function(e){return this.cache[e]},setValue:function(e,t){this.clearCacheSpace(),this.cache[e]=t,this.cacheAdded.push(e),this.saveCache()},saveCache:function(){try{var e=JSON.stringify(this.cache);localStorage.setItem("cache_"+this.bucket,e);try{var t=JSON.stringify(this.cacheAdded);localStorage.setItem("cache_added_"+this.bucket,t)}catch(s){console.error("Unable to save cache added array: ",s)}}catch(s){console.error("Unable to save cache bucket: ",s)}},clearCacheSpace:function(){var e=JSON.stringify(localStorage).length/25e5;if(e>=1){var t=this.cacheAdded.shift();t&&(delete this.cache[t],this.saveCache())}},flush:function(){localStorage.removeItem("cache_"+this.bucket),localStorage.removeItem("cache_added_"+this.bucket)}})},{}],3:[function(e,t,s){"use strict";t.exports=Backbone.Model.extend({initialize:function(e){Object.keys(e).forEach(function(t){this[t]=e[t]}.bind(this))}})},{}],4:[function(e,t,s){"use strict";var r=e("./cache"),n=e("../services/config");t.exports=Backbone.Model.extend({initialize:function(e){this.db=new Firebase(n.db.base+e),this.cache=new r(e)},get:function(e){var t=Promise.defer();if(!e)return t.reject("invalidParams");var s=this.cache.getValue(e);return s?t.resolve(s):this.db.orderByChild("id").equalTo(e).limitToFirst(1).once("value",function(s){var r=s.val();r?(r=r[Object.keys(r)[0]],this.cache.setValue(e,r),t.resolve(r)):t.reject("noResults")}.bind(this),function(e){t.reject(e.code),console.error("Error retrieving database object: ",e)}),t.promise}})},{"../services/config":9,"./cache":2}],5:[function(e,t,s){"use strict";t.exports=Backbone.Router.extend({renderRouteComponents:function(e){var t=$("article.main-content");if(!e||!e.length)return t.empty();var s=e.map(function(e){return $("<"+e.tag+"/>")[0]});"undefined"!=typeof App&&Object.keys(App.tags).forEach(function(e){App.tags[e].unmount(),delete App.tags[e]}),t.html(s),riot.compile(function(){e.forEach(function(e){var t=riot.mount(e.tag,e.args);App.tags[e.tag]=t[0]})})}})},{}],6:[function(e,t,s){"use strict";t.exports=Backbone.Model.extend({initialize:function(){$.getJSON("/assets/json/search.json.gz",function(e){setTimeout(function(){this.buildIndices(e)}.bind(this),250)}.bind(this))},buildIndices:function(e){this.nameIndex=lunr(function(){this.field("n"),this.field("d"),this.ref("i")}),this.effectsIndex=lunr(function(){this.field("e"),this.ref("i")}),this.levelIndex={},this.raceIndex={},this.professionIndex={},e.forEach(function(e){(e.n||e.d)&&this.nameIndex.add(e),e.e&&this.effectsIndex.add(e),e.l&&("undefined"==typeof this.levelIndex[e.l]&&(this.levelIndex[e.l]=[]),this.levelIndex[e.l].push(e)),e.r&&("undefined"==typeof this.raceIndex[e.r]&&(this.raceIndex[e.r]=[]),this.raceIndex[e.r].push(e)),e.p&&("undefined"==typeof this.professionIndex[e.p]&&(this.professionIndex[e.p]=[]),this.professionIndex[e.p].push(e))}.bind(this)),console.info("Finished building search indices.")},search:function(t){var s=e("../services/items"),r=this.searchIndices(t);return r.length?Promise.all(r.map(function(e){return s.get(e)})):Promise.reject("noResults")},searchIndices:function(e){var t=[];if(e.name){var s=this.nameIndex.search(e.name).map(function(e){return e.ref});t.push(s)}if(e.effects){var s=this.effectsIndex.search(e.name).map(function(e){return e.ref});t.push(s)}if(e.level){var s=this.levelIndex[e.level].map(function(e){return e.i});t.push(s)}if(e.race){var s=this.raceIndex[e.level].map(function(e){return e.i});t.push(s)}if(e.profession){var s=this.professionIndex[e.level].map(function(e){return e.i});t.push(s)}return t.length?1===t.length?t[0]:this.arrayIntersect.apply(this,t):[]},arrayIntersect:function(){var e,t,s,r,n,i,o=[],c={};for(i=arguments.length-1,s=arguments[0].length,t=0,e=0;i>=e;e++)r=arguments[e].length,s>r&&(t=e,s=r);for(e=0;i>=e;e++){r=e===t?0:e||t,n=arguments[r].length;for(var a=0;n>a;a++){var u=arguments[r][a];c[u]===e-1?e===i?(o.push(u),c[u]=0):c[u]=e:0===e&&(c[u]=0)}}return o}})},{"../services/items":10}],7:[function(e,t,s){"use strict";t.exports=Backbone.Model.extend({DomReady:function(){var e,t=[],s=document,r=s.documentElement.doScroll,n="DOMContentLoaded",i=(r?/^loaded|^c/:/^loaded|^i|^c/).test(s.readyState);return i||s.addEventListener(n,e=function(){for(s.removeEventListener(n,e),i=1;e=t.shift();)e()}),function(e){i?setTimeout(e,0):t.push(e)}}})},{}],8:[function(e,t,s){"use strict";var r=e("./models/router"),n=new r;n.route("*notFound","pageNotFound",function(){this.renderRouteComponents()}),n.route("","home",function(){this.renderRouteComponents([{tag:"search"},{tag:"item-grid"}])}),n.route("item/:slug","item",function(e){this.renderRouteComponents([{tag:"search"},{tag:"item",args:{slug:e}}])}),n.route("mob/:slug","mob",function(e){this.renderRouteComponents([{tag:"search"},{tag:"mob",args:{slug:e}}])}),n.route("vendor/:slug","vendor",function(e){this.renderRouteComponents([{tag:"search"},{tag:"vendor",args:{slug:e}}])}),Backbone.history.start(),t.exports=n},{"./models/router":5}],9:[function(e,t,s){"use strict";var r=e("../models/config");t.exports={db:new r({base:"https://incandescent-torch-1326.firebaseio.com/"})}},{"../models/config":3}],10:[function(e,t,s){"use strict";var r=e("../models/datastore");t.exports=new r("items")},{"../models/datastore":4}],11:[function(e,t,s){"use strict";var r=e("../models/datastore");t.exports=new r("mobs")},{"../models/datastore":4}],12:[function(e,t,s){"use strict";var r=e("../models/search");t.exports=new r},{"../models/search":6}],13:[function(e,t,s){"use strict";var r=e("../models/utility");t.exports=new r},{"../models/utility":7}],14:[function(e,t,s){"use strict";var r=e("../models/datastore");t.exports=new r("vendors")},{"../models/datastore":4}]},{},[1]);